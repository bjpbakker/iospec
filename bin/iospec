#!/usr/bin/env io

doRelativeFile("../src/iospec.io")

App := Object clone do (
  run := method(argv,
    if (argv size == 0,
      argv := list(".")
    )

    specs := load_specs(argv map(arg, SpecFilesArgument with(arg)))
    if (specs size == 0,
      error("No specs to run")
    )
    Runner clone setFiles(specs) run
  )

  load_specs := method(args,
    args map(arg, FileCollector clone setDirectory(arg root) collect(arg fnpattern)) flatten
  )

  error := method(msg, optionalExitCode,
    writeln(msg)
    System exit(if (optionalExitCode, optionalExitCode, 1))
  )
)

App run(System args slice(1))

